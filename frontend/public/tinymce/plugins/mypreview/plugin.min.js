tinymce.PluginManager.add("mypreview",function(s,e){var o=s.settings,c=!tinymce.Env.ie;s.addCommand("mcePreview",function(){s.windowManager.open({title:"Preview",width:parseInt(s.getParam("plugin_preview_width","650"),10),height:parseInt(s.getParam("plugin_preview_height","500"),10),html:'<iframe src="javascript:\'\'" frameborder="0"'+(c?' sandbox="allow-scripts"':"")+"></iframe>",buttons:{text:"Close",onclick:function(){this.parent().parent().close()}},onPostRender:function(){var e,t="";t+='<base href="'+s.documentBaseURI.getURI()+'">',tinymce.each(s.contentCSS,function(e){t+='<link type="text/css" rel="stylesheet" href="'+s.documentBaseURI.toAbsolute(e)+'">'});var i=o.body_id||"tinymce";-1!=i.indexOf("=")&&(i=(i=s.getParam("body_id","","hash"))[s.id]||i);var n=o.body_class||"";-1!=n.indexOf("=")&&(n=(n=s.getParam("body_class","","hash"))[s.id]||"");var r=s.settings.directionality?' dir="'+s.settings.directionality+'"':"",a=document.createElement("div");if(a.innerHTML=s.getContent(),renderMathInElement(a,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"$",right:"$",display:!1}]}),e="<!DOCTYPE html><html><head>"+t+'</head><body id="'+i+'" class="mce-content-body '+n+'"'+r+">"+a.innerHTML+'<script>document.addEventListener && document.addEventListener("click", function(e) {for (var elm = e.target; elm; elm = elm.parentNode) {if (elm.nodeName === "A") {e.preventDefault();}}}, false);<\/script> <script src="/static/vendor/prism/prism.min.js"><\/script></body></html>',c)this.getEl("body").firstChild.src="data:text/html;charset=utf-8,"+encodeURIComponent(e);else{var d=this.getEl("body").firstChild.contentWindow.document;d.open(),d.write(e),d.close()}}})}),s.addButton("mypreview",{title:"Preview",cmd:"mcePreview",image:e+"/img/mypreview.png"}),s.addMenuItem("mypreview",{text:"Preview",cmd:"mcePreview",context:"view"})});